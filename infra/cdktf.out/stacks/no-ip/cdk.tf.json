{
  "//": {
    "metadata": {
      "version": "0.7.0",
      "stackName": "no-ip",
      "backend": "kubernetes"
    }
  },
  "terraform": {
    "backend": {
      "kubernetes": {
        "secret_suffix": "no-ip",
        "load_config_file": true
      }
    },
    "required_providers": {
      "kubernetes": {
        "version": "~> 2.0",
        "source": "kubernetes"
      },
      "helm": {
        "version": "~> 2.3",
        "source": "helm"
      },
      "kubectl": {
        "version": "~> 1.13.1",
        "source": "gavinbunney/kubectl"
      }
    }
  },
  "provider": {
    "kubernetes": [
      {
        "config_path": "~/.kube/config"
      }
    ],
    "helm": [
      {
        "kubernetes": {
          "config_path": "~/.kube/config"
        }
      }
    ],
    "kubectl": [
      {
        "config_path": "~/.kube/config"
      }
    ]
  },
  "resource": {
    "kubernetes_namespace": {
      "noip_88530D72": {
        "metadata": {
          "name": "no-ip"
        },
        "//": {
          "metadata": {
            "path": "no-ip/no-ip",
            "uniqueId": "noip_88530D72"
          }
        }
      }
    },
    "kubernetes_secret": {
      "noip_nregnerddnsnet_login_0874B637": {
        "data": {
          "username": "nathanregner@gmail.com",
          "password": "${file(\"../../../secrets/no-ip.password.secret\")}"
        },
        "type": "kubernetes.io/basic-auth",
        "metadata": {
          "generate_name": "nregner-ddns-net-",
          "namespace": "${kubernetes_namespace.noip_88530D72.metadata[0].name}"
        },
        "//": {
          "metadata": {
            "path": "no-ip/nregner-ddns-net/login",
            "uniqueId": "noip_nregnerddnsnet_login_0874B637"
          }
        }
      }
    },
    "kubernetes_cron_job": {
      "noip_nregnerddnsnet_update_451D8AF4": {
        "metadata": {
          "generate_name": "update-nregner-ddns-net-",
          "namespace": "${kubernetes_namespace.noip_88530D72.metadata[0].name}"
        },
        "spec": {
          "concurrency_policy": "Forbid",
          "failed_jobs_history_limit": 1,
          "schedule": "*/15 * * * *",
          "successful_jobs_history_limit": 1,
          "job_template": {
            "metadata": {
              "generate_name": "update-nregner-ddns-net-"
            },
            "spec": {
              "backoff_limit": 0,
              "template": {
                "metadata": {
                  "generate_name": "update-nregner-ddns-net-"
                },
                "spec": {
                  "restart_policy": "Never",
                  "container": [
                    {
                      "command": [
                        "/bin/sh",
                        "-c",
                        "curl --silent --show-error --fail            -u \"$NO_IP_USERNAME:$NO_IP_PASSWORD\"           \"https://dynupdate.no-ip.com/nic/update?hostname=$NO_IP_DOMAIN\""
                      ],
                      "image": "curlimages/curl",
                      "name": "nregner-ddns-net",
                      "env": [
                        {
                          "name": "NO_IP_DOMAIN",
                          "value": "nregner.ddns.net"
                        },
                        {
                          "name": "NO_IP_USERNAME",
                          "value_from": {
                            "secret_key_ref": {
                              "key": "username",
                              "name": "${kubernetes_secret.noip_nregnerddnsnet_login_0874B637.metadata[0].name}"
                            }
                          }
                        },
                        {
                          "name": "NO_IP_PASSWORD",
                          "value_from": {
                            "secret_key_ref": {
                              "key": "password",
                              "name": "${kubernetes_secret.noip_nregnerddnsnet_login_0874B637.metadata[0].name}"
                            }
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            }
          }
        },
        "//": {
          "metadata": {
            "path": "no-ip/nregner-ddns-net/update",
            "uniqueId": "noip_nregnerddnsnet_update_451D8AF4"
          }
        }
      }
    }
  }
}